/*
Copyright 2011 Gitana Software, Inc.

Licensed under the Apache License, Version 2.0 (the "License"); 
you may not use this file except in compliance with the License. 

You may obtain a copy of the License at 
	http://www.apache.org/licenses/LICENSE-2.0 

Unless required by applicable law or agreed to in writing, software 
distributed under the License is distributed on an "AS IS" BASIS, 
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
See the License for the specific language governing permissions and 
limitations under the License. 

For more information, please contact Gitana Software, Inc. at this
address:

  info@gitanasoftware.com
*/


var Base=function(){};Base.extend=function(B,E){var F=Base.prototype.extend;Base._prototyping=true;var D=new this;F.call(D,B);D.base=function(){};delete Base._prototyping;var C=D.constructor;var A=D.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==A){this._constructing=true;C.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||F).call(arguments[0],D)}}}};A.ancestor=this;A.extend=this.extend;A.forEach=this.forEach;A.implement=this.implement;A.prototype=D;A.toString=this.toString;A.valueOf=function(G){return(G=="object")?A:C.valueOf()};F.call(A,E);if(typeof A.init=="function"){A.init()}return A};Base.prototype={extend:function(B,H){if(arguments.length>1){var E=this[B];if(E&&(typeof H=="function")&&(!E.valueOf||E.valueOf()!=H.valueOf())&&/\bbase\b/.test(H)){var A=H.valueOf();H=function(){var K=this.base||Base.prototype.base;this.base=E;var J=A.apply(this,arguments);this.base=K;return J};H.valueOf=function(J){return(J=="object")?H:A};H.toString=Base.toString}this[B]=H}else{if(B){var G=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){G=this.extend||G}var D={toSource:null};var F=["constructor","toString","valueOf"];var C=Base._prototyping?0:1;while(I=F[C++]){if(B[I]!=D[I]){G.call(this,I,B[I])}}for(var I in B){if(!D[I]){G.call(this,I,B[I])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(A,D,C){for(var B in A){if(this.prototype[B]===undefined){D.call(C,A[B],B,A)}}},implement:function(){for(var A=0;A<arguments.length;A++){if(typeof arguments[A]=="function"){arguments[A](this.prototype)}else{this.prototype.extend(arguments[A])}}return this},toString:function(){return String(this.valueOf())}});if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(D){var F={put:function(H,G){(G||window).location.hash=this.encoder(H)},get:function(I){var H=((I||window).location.hash).replace(/^#/,"");try{return D.browser.mozilla?H:decodeURIComponent(H)}catch(G){return H}},encoder:encodeURIComponent};var C={id:"__jQuery_history",init:function(){var G='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';D("body").prepend(G);return this},_document:function(){return D("#"+this.id)[0].contentWindow.document},put:function(H){var G=this._document();G.open();G.close();F.put(H,G)},get:function(){return F.get(this._document())}};function E(H){H=D.extend({unescape:false},H||{});F.encoder=I(H.unescape);function I(J){if(J===true){return function(K){return K}}if(typeof J=="string"&&(J=G(J.split("")))||typeof J=="function"){return function(K){return J(encodeURIComponent(K))}}return encodeURIComponent}function G(K){var J=new RegExp(D.map(K,encodeURIComponent).join("|"),"ig");return function(L){return L.replace(J,decodeURIComponent)}}}var B={};B.base={callback:undefined,type:undefined,check:function(){},load:function(G){},init:function(H,G){E(G);A.callback=H;A._options=G;A._init()},_init:function(){},_options:{}};B.timer={_appState:undefined,_init:function(){var G=F.get();A._appState=G;A.callback(G);setInterval(A.check,100)},check:function(){var G=F.get();if(G!=A._appState){A._appState=G;A.callback(G)}},load:function(G){if(G!=A._appState){F.put(G);A._appState=G;A.callback(G)}}};B.iframeTimer={_appState:undefined,_init:function(){var G=F.get();A._appState=G;C.init().put(G);A.callback(G);setInterval(A.check,100)},check:function(){var H=C.get(),G=F.get();if(G!=H){if(G==A._appState){A._appState=H;F.put(H);A.callback(H)}else{A._appState=G;C.put(G);A.callback(G)}}},load:function(G){if(G!=A._appState){F.put(G);C.put(G);A._appState=G;A.callback(G)}}};B.hashchangeEvent={_init:function(){A.callback(F.get());D(window).bind("hashchange",A.check)},check:function(){A.callback(F.get())},load:function(G){F.put(G)}};var A=D.extend({},B.base);if(D.browser.msie&&(D.browser.version<8||document.documentMode<8)){A.type="iframeTimer"}else{if("onhashchange" in window){A.type="hashchangeEvent"}else{A.type="timer"}}D.extend(A,B[A.type]);D.history=A})(jQuery);(function(){window.form2object=function(H,F){H=typeof H=="string"?document.getElementById(H):H;F=F||".";var L=B(H);var Q={};var G={};for(var K=0;K<L.length;K++){var M=L[K].value;if(M===""){continue}var E=L[K].name;var J=E.split(F);var N=Q;for(var I=0;I<J.length;I++){var O=J[I];var D;if(O.indexOf("[]")>-1&&I==J.length-1){D=O.substr(0,O.indexOf("["));if(!N[D]){N[D]=[]}N[D].push(M)}else{if(O.indexOf("[")>-1){D=O.substr(0,O.indexOf("["));var P=O.replace(/^[a-z]+\[|\]$/gi,"");if(!G[D]){G[D]={}}if(!N[D]){N[D]=[]}if(I==J.length-1){N[D].push(M)}else{if(!G[D][P]){N[D].push({});G[D][P]=N[D][N[D].length-1]}}N=G[D][P]}else{if(I<J.length-1){if(!N[O]){N[O]={}}N=N[O]}else{N[O]=M}}}}}return Q};function B(F){var D=[];var G=F.firstChild;while(G){if(G.nodeName.match(/INPUT|SELECT|TEXTAREA/i)){D.push({name:G.name,value:A(G)})}else{var E=B(G);D=D.concat(E)}G=G.nextSibling}return D}function A(D){if(D.nodeName=="INPUT"){if(D.type.toLowerCase()=="radio"||D.type.toLowerCase()=="checkbox"){if(D.checked){return D.value}}else{if(!D.type.toLowerCase().match(/button|reset|submit|image/i)){return D.value}}}else{if(D.nodeName=="TEXTAREA"){return D.innerHTML}else{if(D.nodeName=="SELECT"){return C(D)}}}return""}function C(H){var E=H.multiple;if(!E){return H.value}var D=[];for(var G=H.getElementsByTagName("option"),I=0,F=G.length;I<F;I++){if(G[I].selected){D.push(G[I].value)}}return D}window.form2json=window.form2object})();(function(A){Ratchet=Base.extend({constructor:function(){this.base();var D=this;var C=Ratchet.makeArray(arguments);do{var B=C.shift();if(B){if(Ratchet.isArray(B)&&(Ratchet.isNode(B[0])||Ratchet.isElement(B[0]))){this.el=B[0]}else{if(Ratchet.isNode(B)||Ratchet.isElement(B)){this.el=B}else{if(Ratchet.isFunction(B)){this.setupFunction=B}else{this.parent=B}}}}}while(B);if(!this.el){this.el=document.body}this.childRatchets={};this.authRequiredPatterns=[];this.routes={};this.id=Ratchet.generateId();this.gadgetInstances=[];this.gadgetType=null;this.subscriptions={};A(this.el).attr("ratchet",this.id);if(!this.parent){this.dispatchCount=0;this.dispatchCompletionCount=0}this.incrementDispatchCount=function(){D.topRatchet().dispatchCount++};this.incrementDispatchCompletionCount=function(){D.topRatchet().dispatchCompletionCount++};this.isDispatchCompleted=function(){return(D.topRatchet().dispatchCompletionCount==D.topRatchet().dispatchCount)};this.executeMatch=function(K,L){var J={};if(K=="**"){J["**"]=L;return J}if((K.indexOf("{")==-1)&&(K.indexOf("*")==-1)){if(K==L){return J}}var I=K.split("/");var F=L.split("/");if((I.length==0)&&(F.length==0)){return J}do{var H=I.shift();var G=F.shift();if(!Ratchet.isEmpty(H)&&!Ratchet.isEmpty(G)){if(H=="*"){}else{if(H=="**"){J["**"]="/"+[].concat(G,F).join("/");break}else{if(Ratchet.startsWith(H,"{")){var E=H.substring(1,H.length-1);J[E]=G}else{if(H==G){}else{return null}}}}}else{if((H&&Ratchet.isEmpty(G))||(Ratchet.isEmpty(H)&&G)){return null}}}while(!Ratchet.isEmpty(H)&&!Ratchet.isEmpty(G));return J};this.findHandler=function(F){var G=null;var I=null;var J=null;for(var K in D.routes){var E=D.routes[K];if(E.method==F.route.method){I=D.executeMatch(E.uri,F.route.uri);if(I){J=E.handler;break}}}if(J){var H=new Ratchet.RenderContext(this,F.route,null,F.params);Ratchet.copyInto(H.model,F.model);H.tokens=I;G=function(L){return function(){J.call(J,L,L.route.data)}}(H)}else{A("body").trigger("no-match",[F]);var H=new Ratchet.RenderContext(this,F.route,this.el);Ratchet.copyInto(H.model,F.model);H.swap()}return G};this.topRatchet=function(){var E=this;while(E.parent){E=E.parent}return E};this.init()},init:function(){var B=this;if(!this.parent){A.history.init(function(C){if(C==""){}if(C!=""){B.dispatch({method:"GET",uri:"#"+C})}},{unescape:",/#"})}},setup:function(){if(this.setupFunction){this.setupFunction.call(this)}if(!this.gadgetType){this.gadgetType=A(this.el).attr("gadget")}if(this.gadgetType){this.gadgetInstances=Ratchet.GadgetRegistry.instantiate(this.gadgetType,this);A.each(this.gadgetInstances,function(B,C){C.setup.call(C)})}},teardown:function(){var B=this;A.each(this.childRatchets,function(C,D){D.teardown()});A.each(this.childRatchets,function(C,D){delete D});this.childRatchets={};A.each(this.subscriptions,function(C,D){D.unsubscribe(C)});A.each(this.gadgetInstances,function(C,D){D.teardown()});this.gadgetInstances=[];A.each(this.routes,function(D,C){delete B.routes[D]});this.routes={}},processGadgets:function(B){var D=this;var C={};A(B.closestDescendants("[gadget]")).each(function(){var F=A(this).attr("gadget");var H=false;var E=A(this).attr("ratchet");if(E){var G=D.childRatchets[E];if(G){G.el=this;A(G.el).attr("ratchet",E);H=true}}if(!H){G=new Ratchet(A(this),D,function(){this.gadgetType=F});D.childRatchets[G.id]=G;E=G.id}C[E]={};A.each(A(this)[0].attributes,function(J,L){var I=L.name;var K=L.value;if(K){C[E][I]=K}})});A.each(D.childRatchets,function(E,G){var F=C[E];G.dispatch(B.route,F)})},get:function(){var B=Ratchet.makeArray(arguments);if(Ratchet.isFunction(B[0])){B.unshift("**")}B.unshift("GET");this.route.apply(this,B)},post:function(){var B=Ratchet.makeArray(arguments);if(Ratchet.isFunction(B[0])){B.unshift("**")}B.unshift("POST");this.route.apply(this,B)},put:function(D,C){var B=Ratchet.makeArray(arguments);if(Ratchet.isFunction(B[0])){B.unshift("**")}B.unshift("PUT");this.route.apply(this,B)},del:function(D,C){var B=Ratchet.makeArray(arguments);if(Ratchet.isFunction(B[0])){B.unshift("**")}B.unshift("DELETE");this.route.apply(this,B)},route:function(){var H=null;var F=null;var C=null;var E=null;var B=Ratchet.makeArray(arguments);if(B.length==2){H=B.shift();F="**";C=B.shift()}else{if(B.length==3){H=B.shift();F=B.shift();C=B.shift()}else{if(B.length==4){H=B.shift();F=B.shift();C=B.shift();E=B.shift()}else{Ratchet.error("Wrong number of arguments");return }}}if(!E){E=C}var D=function(J,I){return function(K,L){I.call(J,K,L)}}(E,C);var G=H+"-"+F;this.routes[G]={uri:F,method:H,handler:D}},dispatch:function(B,D){var E=this;this.teardown();this.setup();if(Ratchet.startsWith(B.uri,"#")){B.uri=B.uri.substring(1)}var C=new Ratchet.RenderContext(this,B,null,D);this.incrementDispatchCount();this.ensureAuthentication.call(this,C,function(){var F=E.findHandler(C);if(F){F()}},function(){alert("Authentication failed - not authenticated")})},run:function(){var E={method:"GET",data:{}};var D=Ratchet.makeArray(arguments);if(D.length==0){uri=window.location.href;if(uri.indexOf("#")>-1){uri=uri.substring(uri.indexOf("#")+1)}else{uri="/"}E.uri=uri}else{if(D.length==1){E.uri=D.shift()}else{if(D.length==2){var C=D.shift();var B=D.shift();if(Ratchet.isString(B)){E.method=C;E.uri=B}else{E.uri=C;E.data=B}}else{if(D.length==3){E.method=D.shift();E.uri=D.shift();E.data=D.shift()}}}}if(E.method=="GET"&&!this.parent){A.history.load(E.uri)}else{this.dispatch(E)}},observable:function(){var E;var H;var B;var D;var C=Ratchet.makeArray(arguments);if(C.length==1){E="global";H=C.shift()}else{if(C.length==2){E=C.shift();H=C.shift()}else{if(C.length==3){E="global";H=C.shift();B=C.shift();D=C.shift()}else{if(C.length==4){E=C.shift();H=C.shift();B=C.shift();D=C.shift()}}}}var G=Ratchet.ScopedObservables.get(E);var F=G.observable(H);if(B&&D){F.subscribe(B,D);this.subscriptions[B]=F}return F},dependentObservable:function(){var C=null;var F=null;var D=null;var B=Ratchet.makeArray(arguments);if(B.length==2){C="global";F=B.shift();D=B.shift()}else{if(B.length==3){C=B.shift();F=B.shift();D=B.shift()}else{Ratchet.error("Wrong number of arguments");return }}var E=Ratchet.ScopedObservables.get(C);return E.dependentObservable(F,D)},requireAuthentication:function(B){this.authRequiredPatterns.push(B)},ensureAuthentication:function(D,B,H){var I=this;if(this.authRequiredPatterns.length==0){B()}else{var G=false;for(var C=0;C<this.authRequiredPatterns.length;C++){var E=this.authRequiredPatterns[C];var F=this.executeMatch(E,D.route.uri);if(F){G=true}}if(G){if(this.authenticator&&this.authenticator.authenticate){this.authenticator.authenticate(D,function(){B()},function(){H()})}else{this.authenticate.call(I,D,function(){B()},function(){H()})}}else{B()}}},authenticate:function(C,B,D){B()}})})(jQuery);(function(){Ratchet.uniqueIdCounter=0;Ratchet.makeArray=function(A){return Array.prototype.slice.call(A)};Ratchet.stringify=function(A,B){var C=null;if(B){C=JSON.stringify(A,null,"  ")}else{C=JSON.stringify(A)}return C};Ratchet.isString=function(A){return(typeof A=="string")};Ratchet.isFunction=function(A){return Object.prototype.toString.call(A)==="[object Function]"};Ratchet.startsWith=function(B,A){return B.substr(0,A.length)===A};Ratchet.copyInto=function(C,B){for(var A in B){if(B.hasOwnProperty(A)&&!this.isFunction(this[A])){C[A]=B[A]}}};Ratchet.isArray=function(A){return A.push&&A.slice};Ratchet.isUndefined=function(A){return(typeof A=="undefined")};Ratchet.isEmpty=function(A){return this.isUndefined(A)||A==null};Ratchet.generateId=function(){Ratchet.uniqueIdCounter++;return"ratchet-"+Ratchet.uniqueIdCounter};Ratchet.isNode=function(A){return(typeof Node==="object"?A instanceof Node:typeof A==="object"&&typeof A.nodeType==="number"&&typeof A.nodeName==="string")};Ratchet.isElement=function(A){return(typeof HTMLElement==="object"?A instanceof HTMLElement:typeof A==="object"&&A.nodeType===1&&typeof A.nodeName==="string")};Ratchet.debug=function(A){if(!this.isUndefined(console)){console.log(A)}};Ratchet.error=function(A){if(!this.isUndefined(console)){console.error(A)}};Ratchet.copyAttributes=function(B,E){for(var A=0;A<$(B)[0].attributes.length;A++){var C=$(B)[0].attributes[A].name;var D=$(B)[0].attributes[A].value;$(E).attr(C,D)}}})(window);(function(A){Ratchet.Observable=Base.extend({constructor:function(B,D){var C=this;this.base();this.id=B+"-"+D;this.value=null;this.subscribers={};this.dependentOnUs={};this.notifySubscribers=function(){var E=this;A.each(this.subscribers,function(G,F){F(E.value)})};this.notifyDependents=function(){A.each(this.dependentOnUs,function(F,E){E.onDependencyChange()})};this.valueFunction=null},setValueFunction:function(B){this.valueFunction=B;this.onDependencyChange()},subscribe:function(C,B){if(!this.isSubscribed(C)){this.subscribers[C]=B}},unsubscribe:function(B){delete this.subscribers[B]},isSubscribed:function(B){return this.subscribers[B]},markDependentOnUs:function(B){this.dependentOnUs[B.id]=B},onDependencyChange:function(){var B=this.get();if(this.valueFunction){var C=this.valueFunction();if(B!=C){this.set(C)}}},set:function(B){this.value=B;this.notifyDependents();this.notifySubscribers()},get:function(B){var C=this.value;if(!C){C=B}return C},clear:function(){delete this.value;this.notifyDependents();this.notifySubscribers()}})})(jQuery);(function(A){Ratchet.Observables=Base.extend({constructor:function(B){this.base();this.scope=B;this.observables={}},observable:function(D,B){if(!this.observables[D]){var C=new Ratchet.Observable(this.scope,D);if(B){C.set(B)}this.observables[D]=C}return this.observables[D]},dependentObservable:function(G,C){var F=this;if(!this.observables[G]){var E=this.observable(G);var B=new Ratchet.Observables(this.scope);B.observable=function(H,J){var I=F.observable(H,J);I.markDependentOnUs(E);return I};var D=function(){return C.call(B)};E.setValueFunction(D)}return this.observables[G]},observables:function(){return this.observables}})})(jQuery);(function(A){Ratchet.ScopedObservables={};Ratchet.ScopedObservables.map={};Ratchet.ScopedObservables.get=function(B){if(!Ratchet.ScopedObservables.map[B]){Ratchet.ScopedObservables.map[B]=new Ratchet.Observables(B)}return Ratchet.ScopedObservables.map[B]}})(jQuery);(function(A){Ratchet.RenderContext=Base.extend({constructor:function(F,D,C,E){this.base();var B=A("<div></div>");if(C){B.html(A(C).html())}jQuery.extend(this,B,{route:D});this.ratchet=function(){return F};this.topRatchet=function(){return this.ratchet().topRatchet()};this._getContainer=function(){return B};this.children=function(){return B.children()};this.model={};this.params=(E?E:{})},swap:function(C){if(C){C.call(C,this)}this.ratchet().processGadgets.call(this.ratchet(),this);A(this.ratchet().el).html("");var B=A("<div></div>");A(this.ratchet().el).append(B);A(B).replaceWith(this[0].childNodes);Ratchet.copyAttributes(this,this.ratchet().el);A("body").trigger("swap",[this.ratchet()]);this.ratchet().incrementDispatchCompletionCount();A("body").trigger("dispatch",[this.ratchet(),this.ratchet().isDispatchCompleted()])},fetch:function(){var I=this;var F=Ratchet.makeArray(arguments);var E=F.shift();var D=null;var B=null;var H=null;var C=F.shift();if(Ratchet.isFunction(C)){B=C;H=F.shift()}else{D=C;B=F.shift();H=F.shift()}if(!D){D={}}var G=(E.match(/\.json$/)||D.json);A.ajax(A.extend({url:E,data:{},dataType:(G?"json":null),type:"get",success:function(J){if(B){B.call(B,I,J)}},failure:function(J){if(H){H.call(H,I,J)}}},D))},transform:function(D,F,E,B){var H=this;var I=Ratchet.makeArray(arguments);var D=I.shift();var G=this.model;var E=null;var B=null;var C=I.shift();if(Ratchet.isFunction(C)){E=C;B=I.shift()}else{F=C;Ratchet.copyInto(G,F);E=I.shift();B=I.shift()}var J=Ratchet.renditionEngine;if(!J){if(Ratchet.isUndefined(Ratchet.jQueryTemplateEngine)){Ratchet.error("No rendition engine is provided and cannot create a default jQueryTemplateEngine since the plugin is not included.");return }else{J=new Ratchet.jQueryTemplateEngine("default");Ratchet.renditionEngine=J}}J.render(H,D,G,function(K){if(E){E(K)}},function(L,K){if(B){B(L,K)}})},observable:function(){var G;var H;var F;var E=Ratchet.makeArray(arguments);if(E.length==1){G="global";H=E.shift()}else{if(E.length==2){var D=E.shift();var C=E.shift();if(Ratchet.isFunction(C)){G="global";H=D;F=C}else{G=D;H=C}}else{if(E.length==3){G=E.shift();H=E.shift();F=E.shift()}}}var B=this.id;return this.ratchet().observable(G,H,B,F)},dependentObservable:function(){return this.ratchet().dependentObservable.apply(this.ratchet(),arguments)},subscribe:function(){var B=Ratchet.makeArray(arguments);var D=null;var F=null;var C=null;if(B.length==2){D="global";F=B.shift();C=B.shift()}else{D=B.shift();F=B.shift();C=B.shift()}var E=function(G){return function(){C.call(G)}}(this);this.ratchet().observable(D,F,E)},run:function(){this.ratchet().run.apply(this.ratchet(),arguments)}})})(jQuery);(function(A){Ratchet.Gadget=Base.extend({constructor:function(D,B){this.base();var C=this;this.id=D;this.route=function(H,I,F,G){if(Ratchet.isString(F)){var E=F;F=function(K,J){C.renderTemplate.call(C,K,J,E)}}B.route(this,H,I,F,G)};this.ratchet=function(){return B};this.topRatchet=function(){var E=this.ratchet();while(E.parent){E=E.parent}return E};this.getGadgetId=function(){return this.id}},app:function(){return this.topRatchet()},setup:function(){},teardown:function(){},subscribe:function(){var B=Ratchet.makeArray(arguments);var D=null;var F=null;var C=null;if(B.length==2){D="global";F=B.shift();C=B.shift()}else{D=B.shift();F=B.shift();C=B.shift()}var E=function(G){return function(){C.call(G)}}(this);this.observable(D,F,E)},observable:function(){var G;var H;var F;var E=Ratchet.makeArray(arguments);if(E.length==1){G="global";H=E.shift()}else{if(E.length==2){var D=E.shift();var C=E.shift();if(Ratchet.isFunction(C)){G="global";H=D;F=C}else{G=D;H=C}}else{if(E.length==3){G=E.shift();H=E.shift();F=E.shift()}}}var B=this.ratchet().id+"-"+this.getGadgetId();return this.ratchet().observable(G,H,B,F)},dependentObservable:function(){return this.ratchet().dependentObservable.apply(this.ratchet(),arguments)},refreshHandler:function(B){return function(C){return function(){C.run(C.route.method,C.route.uri,C.route.data)}}(B)},run:function(){this.ratchet().run.apply(this.ratchet(),arguments)},get:function(){var B=Ratchet.makeArray(arguments);B.push(this);this.ratchet().get.apply(this.ratchet(),B)},post:function(){var B=Ratchet.makeArray(arguments);B.push(this);this.ratchet().post.apply(this.ratchet(),B)},put:function(C,B){var D=Ratchet.makeArray(arguments);D.push(this);this.ratchet().put.apply(this.ratchet(),D)},del:function(C,B){var D=Ratchet.makeArray(arguments);D.push(this);this.ratchet().del.apply(this.ratchet(),D)}})})(jQuery);(function(A){Ratchet.GadgetRegistry={};Ratchet.GadgetRegistry.registry={};Ratchet.GadgetRegistry.register=function(C,B){if(!Ratchet.GadgetRegistry.registry[C]){Ratchet.GadgetRegistry.registry[C]=[]}Ratchet.GadgetRegistry.registry[C].push(B)};Ratchet.GadgetRegistry.instantiate=function(E,D){var C=[];var B=Ratchet.GadgetRegistry.registry[E];if(B){A.each(B,function(G,H){var F=new H(E,D);C.push(F)})}return C}})(jQuery);(function(A){A.ratchet=Ratchet;A.fn.ratchet=function(B){return new Ratchet(this[0],B)};A.fn.serializeObject=function(){return window.form2object(this[0])};A.fn.closestDescendants=function(C){if(!C||C==""){return A()}var D=[];var B=function(G){if(G.is(C)){D.push(G);return }var F=G.children();for(var E=0;E<F.length;E++){B(A(F[E]))}};B(this);return A(D)}})(jQuery);
